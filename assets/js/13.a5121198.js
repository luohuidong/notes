(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{230:function(t,e,a){"use strict";a.r(e);var n=a(0),r=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"js-为什么-0-1-0-2-不等于-0-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-为什么-0-1-0-2-不等于-0-3","aria-hidden":"true"}},[t._v("#")]),t._v(" JS-为什么 0.1 + 0.2 不等于 0.3")]),t._v(" "),a("h2",{attrs:{id:"了解-ieee-754"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#了解-ieee-754","aria-hidden":"true"}},[t._v("#")]),t._v(" 了解 IEEE 754")]),t._v(" "),a("p",[t._v("JS 的 "),a("code",[t._v("Number")]),t._v(" 类型遵循的是 IEEE 754 标准，使用的是 64 位固定长度来表示。")]),t._v(" "),a("p",[t._v("IEEE 754 浮点数由三个域组成，分别为 sign bit (符号位)、exponent bias (指数偏移值) 和 fraction (分数值)。64 位中，sign bit 占 1 位，exponent bias 占 11 位，fraction 占 52 位。通过公式表示浮点数的值 "),a("strong",[t._v("value = sign x exponent x fraction")]),t._v("。当一个数为正数，sign bit 为 0，当为负数时，sign bit 为 1.")]),t._v(" "),a("p",[t._v("以 0.1 转换为 IEEE 754 标准表示为例解释一下如何求 exponent bias 和 fraction。转换过程主要经历 3 个过程：")]),t._v(" "),a("ol",[a("li",[t._v("将 0.1 转换为二进制表示")]),t._v(" "),a("li",[t._v("将转换后的二进制通过科学计数法表示")]),t._v(" "),a("li",[t._v("将通过科学计数法表示的二进制转换为 IEEE 754 标准表示")])]),t._v(" "),a("h3",{attrs:{id:"将-0-1-转换为二进制表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-0-1-转换为二进制表示","aria-hidden":"true"}},[t._v("#")]),t._v(" 将 0.1 转换为二进制表示")]),t._v(" "),a("p",[t._v("回顾一下一个数的小数部分如何转换为二进制。一个数的小数部分，乘以 2，然后取整数部分的结果，再用计算后的小数部分重复计算，直到小数部分为 0 。")]),t._v(" "),a("p",[t._v("因此 0.1 转换为二进制表示的过程如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("小数")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("x2 的结果")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("整数部分")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0.2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0.4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0.8")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.8")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1.2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0.4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0.8")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.8")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0.6")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1.2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")])])])]),t._v(" "),a("p",[t._v("得到 0.1 的二进制表示为 0.00011...(无限重复 0011)")]),t._v(" "),a("h3",{attrs:{id:"通过科学计数法表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过科学计数法表示","aria-hidden":"true"}},[t._v("#")]),t._v(" 通过科学计数法表示")]),t._v(" "),a("p",[t._v("0.00011...(无限重复 0011) 通过科学计数法表示则是 1.10011001...(无线重复 1001)*2")]),t._v(" "),a("h3",{attrs:{id:"转换为-ieee-754-标准表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#转换为-ieee-754-标准表示","aria-hidden":"true"}},[t._v("#")]),t._v(" 转换为 IEEE 754 标准表示")]),t._v(" "),a("p",[t._v("当经过科学计数法表示之后，就可以求得 exponent bias 和 fraction 了。")]),t._v(" "),a("p",[t._v("exponent bias (指数偏移值) "),a("strong",[t._v("等于")]),t._v(" 双精度浮点数"),a("strong",[t._v("固定偏移值")]),t._v(" (2-1) 加上指数实际值(即 2 中的 -4) 的 "),a("strong",[t._v("11 位二进制表示")]),t._v("。为什么是 11 位？因为 exponent bias 在 64 位中占 11 位。")]),t._v(" "),a("p",[t._v("因此 0.1 的 exponent bias "),a("strong",[t._v("等于")]),t._v(" 1023 + (-4) = 1019 的 11 位二进制表示，即 011 1111 1011。")]),t._v(" "),a("p",[t._v("再来获取 0.1 的 fraction，fraction 就是 1.10011001...(无线重复 1001) 中的小数位，由于 fraction 占 52 位所以抽取 52 位小数，1001...(中间有 11 个 1001)...1010 "),a("strong",[t._v("(请注意最后四位，是 1010 而不是 1001，因为四舍五入有进位，这个进位就是造成 0.1 + 0.2 不等于 0.3 的原因)")]),t._v("。\n**\n到此，终于可以将 0.1 转换为 IEEE 754 表示了。")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("       011 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1011")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".1010\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sign bit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exponent bias"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fraction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("此时如果将这个数转换为十进制，可以发现值已经变为 0.100000000000000005551115123126 而不是 0.1 了。")]),t._v(" "),a("h2",{attrs:{id:"回归到-0-1-0-2-0-3-这个问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回归到-0-1-0-2-0-3-这个问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 回归到 0.1 + 0.2 != 0.3 这个问题")]),t._v(" "),a("p",[t._v("通过上面的过程，我们知道了 JS 因为遵循了 IEEE 754 产生浮点误差的原因。因此不仅 0.1 会产生误差，0.2 及 0.3 也是如此，因此最后造成了 0.1 + 0.2 不等于 0.3 的结果。")]),t._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=8afbTaA-gOQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("YouTube - Decimal to IEEE 754 Floating Point Representation"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/camsong/blog/issues/9",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub camsong - JavaScript 浮点数陷阱及解法"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E6%9C%89%E7%AC%A6%E8%99%9F%E6%95%B8%E8%99%95%E7%90%86#%E5%8E%9F%E7%A0%81",target:"_blank",rel:"noopener noreferrer"}},[t._v("维基百科 - 符号位相关信息"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/IEEE_754",target:"_blank",rel:"noopener noreferrer"}},[t._v("维基百科 - IEEE 754"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工具","aria-hidden":"true"}},[t._v("#")]),t._v(" 工具")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://www.binaryconvert.com/convert_double.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("十进制转 IEEE 754 双精度浮点数值"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=r.exports}}]);